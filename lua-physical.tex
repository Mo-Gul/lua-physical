%!TEX program = lualatex
\documentclass{ltxdoc}

\usepackage{url}
\usepackage[english]{babel}
\usepackage{hyperref}
\usepackage{luacode}
\usepackage{listings}
\usepackage{siunitx}
\usepackage{tabularx}
\usepackage{float}
\usepackage{framed}

\begin{luacode*}
physical = require("physical")
\end{luacode*}

\newcommand{\q}[1]{%
  \directlua{tex.print(physical.Quantity.tosiunitx(#1,"add-decimal-zero=true,scientific-notation=fixed,exponent-to-prefix=false"))}%
}


% siunitx config
\sisetup{
	output-decimal-marker = {.}, 
	per-mode = symbol,
	separate-uncertainty = false,
	add-decimal-zero = true,
	exponent-product = \cdot,
	round-mode=off
}

\lstdefinelanguage{lua}
{
  morekeywords={
    for,end,function,do,if,else,elseif,then,
    tex.print,tex.sprint,io.read,io.open,string.find,string.explode,require
  },
  morecomment=[l]{--},
  morecomment=[s]{--[[}{]]},
  morestring=[b]''
}

\lstset{
  numberstyle=\footnotesize\color{gray},
  keywordstyle=\ttfamily\bfseries\color{blue},
  basicstyle=\ttfamily\footnotesize,
  commentstyle=\itshape\color{gray},
  stringstyle=\ttfamily,
  tabsize=2,
  numbers=left,
  showstringspaces=false,
  breaklines=true,
  framexleftmargin=20pt,
  framexrightmargin=3.5pt,
  xleftmargin=23.5pt,
  breakindent=30pt,
  morekeywords={},
  frame=single,
  mathescape=false,
  captionpos=b
}









\begin{document}
	\title{The \textsc{lua-physical} library \\\ \\\normalsize Version 0.1}
	\author{Thomas Jenni}
	\date{\today}
	\maketitle



\begin{abstract}
|lua-physical| is a pure Lua library which provides functions and object for doing computation with physical quantities. This package provides a standard set of units of the SI and the imperial system. It is possible to give a number a mesurement uncertainty. 

 is also integrated and is calculated by gaussian error propagation. The package includes some
\end{abstract}

\tableofcontents






\newpage
\section{Introduction}

The author of this package is a teacher at the \emph{Kantonsschule Zug, Switzerland}, a high-school. The main use of this package is to write physics problem sets and integrate the calculation directly into the luatex-file. The package is now in use for more than two years and a lot of bugs have been found and crushed. Nevertheless it could be possible that some bugs are still there, living uncovered. Therefore I recommend not to use this library productively in industry or science. If one does so, it's the responsability of the user to check results for plausability. If the user finds some bugs, please report them on github.com or directly to the author.

E-Mail: \url{thomas.jenni (at) ksz.ch}





\lstset{language=[LaTex]Tex}

\section{Basic usage}
Since this package is pure lua library one has to require it explicitly by calling 
\lstinline{require("physical")}. For printing results the |siunitx| package is used. It's recommended to define a shortcut like \lstinline{\q} or \lstinline{\Qty} to convert the lua quantity object to a siunitx expression. An example preamble is shown in the following.

\begin{lstlisting}[language=Tex, caption=basic preamble]
  \usepackage{siunitx}

  % configure siunitx
  \sisetup{
    output-decimal-marker = {.}, 
    per-mode = symbol,
    separate-uncertainty = false,
    add-decimal-zero = true,
    exponent-product = \cdot,
    round-mode = off
  }

  % load lua-physical
  \begin{luacode*}
    physical = require("physical")
  \end{luacode*}

  % shortcut for printing physical quantities
  \newcommand{\q}[1]{%
    \directlua{tex.print(physical.Quantity.tosiunitx(#1,"scientific-notation=fixed,exponent-to-prefix=false"))}%
  }
\end{lstlisting}




\newpage
Given the preamble one can use now units in lua code and insert results in the latex code.

\begin{lstlisting}[caption={basic usage}]
\begin{luacode}
  s = 10 * _m
	t = 2 * _s
	v = s/t
\end{luacode}

A car travels $\q{s}$ in $\q{t}$. calculate its velocity.
$$
	v=\frac{s}{t} = \frac{\q{s}}{\q{t}} = \q{v} = \q{v:to(_km/_h)}
$$
\end{lstlisting}


\begin{luacode}
  s = 10 * _m
  t = 2 * _s
  v = s/t
\end{luacode}

\noindent
\fbox{\begin{minipage}{\linewidth}
A car travels $\q{s}$ in $\q{t}$. Calculate its velocity.
$$
  v=\frac{s}{t} = \frac{\q{s}}{\q{t}} = \q{v} = \q{v:to(_km/_h)}
$$
\end{minipage}}













\renewcommand{\arraystretch}{1.5}


% define macros for dimensions

\newcommand{\M}[1][]{\mathrm{M}^{#1}\,}

\renewcommand{\L}[1][]{\mathrm{L}^{#1}\,}

\newcommand{\T}[1][]{\mathrm{T}^{#1}\,}

\newcommand{\I}[1][]{\mathrm{I}^{#1}\,}

\renewcommand{\theta}[1][]{\mathrm{theta}^{#1}\,}

\renewcommand{\N}[1][]{\mathrm{N}^{#1}\,}

\renewcommand{\J}[1][]{\mathrm{J}^{#1}\,}

\newcommand{\1}{\mathrm{1}}




\newpage
\section{Supported Units}

There are a few units with dimension $\1$. The unit Bel is only available with prefix decibel, because |_B| is the unit byte.

\begin{table}[H]
\centering
\begin{tabularx}{\linewidth}{%
  l%
  l%
  X%
}

Unit & Symbol & Definition \\\hline

number & 
|_1| & 
The number one.  \\\hline


percent \% &  
|_percent| & 
|1e-2*_1|  \\\hline


permille \textperthousand & 
|_permille| & 
|1e-3*_1|  \\\hline

parts-per-million & 
|_ppm| &
|1e-6*_1|  \\\hline

parts-per-billion & 
|_ppb| &
|1e-9*_1|  \\\hline

parts-per-trillion & 
|_ppt| &
|1e-12*_1|  \\\hline

parts-per-quadrillion & 
|_ppq| &
|1e-15*_1|  \\\hline


decibel & 
|_dB| & 
|_1|  \\\hline

\end{tabularx}
\caption{Dimensionless units}
\end{table}





\begin{table}[H]
\centering
\begin{tabularx}{\linewidth}{%
  >{\setlength\hsize{0.5\hsize}}X%
  l%
  l%
  c%
  >{\setlength\hsize{1.5\hsize}}X%
}

Quantity & Unit & Symbol & Dim. & Definition \\\hline

length &
meter & 
|_m| & 
$\L$ &
The distance light travels in vacuum during $1/ \num{299792458}$ second. \\\hline

mass &
kilogram  &  
|_kg| & 
$\M$ & 
The mass of the international protoype of the kilogram.\\\hline

time &
second & |_s| & 
$\T$ & 
Is \num{9192631770} times the period of the radiation from the transition between the two hyperfine levels of the ground state of caesium-133.  \\\hline

electric \newline current &
ampere & 
|_A| & 
$\I$ & 
The constant current which, if maintained in two straight parallel conductors of infinte length, of negligible circular crosss-section, and placed $\SI{1}{\m}$ apart in vacuum, would produce between these conductors a force equal to $\SI{2e-7}{\N\per\m}$.  \\\hline


thermodynamic \newline temperature &
kelvin  & 
|_K| & 
$\Theta$ & 
Is the fraction $1/\num{273.16}$ of the thermodynamic temperature of the triple point of water.  \\\hline

amount of \newline substance &
mole  & 
|_mol| &  
$\N$ & 
Amount of substance that contains as many particles as there are atoms in $\SI{0.012}{\kg}$ of carbon-12. \\\hline

luminous \newline intensity &
candela & 
|_cd| & 
$\J$ & 
the luminous intensity, in a given direction, of a source that emits monochromatic radiation of frequenc $\SI{540e12}{\Hz}$ and has a radiant intensity in that direction of $(1/\num{683}) \, \si{\W\per\steradian}$

\end{tabularx}
\caption{Base units of the International System of Units (SI)}
\end{table}



\begin{table}[H]
\centering
\begin{tabularx}{\linewidth}{%
  >{\setlength\hsize{1.2\hsize}}X%
  l%
  l%
  l%
  >{\setlength\hsize{0.8\hsize}}X%
}

Quantity & Unit & Symbol & Dimension & Definition \\\hline

plane angle & 
radian &
|_rad| & 
$1$ & 
|\1| \\\hline

solid angle & 
steradian &
|_sr| & 
$\1$ & 
|_rad^2| \\\hline

frequency &
hertz & 
|_Hz| & 
$\T[-1]$ & 
|1/_s| \\\hline

force &
newton & 
|_N| & 
$\M \L \T[-2]$ & 
|_kg*_m/_s^2| \\\hline

pressure &
pascal & 
|_Pa| & 
$\M \L[-1] \T[-2]$ & 
|_N/_m^2| \\\hline

energy &
joule & 
|_J| & 
$\M \L[2] \T[-2]$ & 
|_N*_m| \\\hline


power &
watt & 
|_W| & 
$\M \L[2] \T[-3]$ & 
|_J/_s| \\\hline

electric \newline charge &
coulomb & 
|_C| & 
$\T \I$ & 
|_A*_s| \\\hline

electric potential \newline difference &
volt & 
|_V| & 
$\M \L[2] \T[-3] \I[-1]$ & 
|_J/_C| \\\hline

capacitance &
farad & 
|_F| & 
$\L[-2] \M[-1] \T[4] \I[2]$ & 
|_C/_V| \\\hline

electric \newline resistance &
ohm & 
|_Ohm| & 
$\L[2] M \T[-3] \I[-2]$ & 
|_V/_A| \\\hline

electric \newline conductance &
siemens & 
|_S| & 
$\L[-2] \M[-1] T^{3} I^{2}$ & 
|_A/_V| \\\hline

magnetic \newline flux &
weber & 
|_Wb| & 
$\L[2] \M \T[-2] \I[-1]$ & 
|_V*_s| \\\hline

magnetic flux \newline density &
tesla & 
|_T| & 
$\M \T[-2] \I[-1]$ & 
|_V*_s| \\\hline

inductance &
henry & 
|_H| & 
$\L[2] \M \T[-2] \I[-2]$ & 
|_Wb/_A| \\\hline

Celsius \newline temperature &
degree Celsius & 
|_degC| & 
$\Theta$ & 
|_K| \\\hline

luminous flux &
lumen & 
|_lm| & 
$\J$ &
|_cd*_sr| \\\hline

illuminance &
lux & 
|_lux| & 
$\L[-2] \J$ &
|_lm/_m^2| \\\hline

activity &
becquerel & 
|_Bq| & 
$\T[-1]$ &
|1/_s| \\\hline

absorbed dose &
gray & 
|_Gy| & 
$\L[2] \T[-2]$ &
|_J/_kg| \\\hline

dose equivalent &
sievert & 
|_Sv| & 
$\L[2] \T[-2]$ &
|_J/_kg| \\\hline


catalytic \newline activity &
katal & 
|_kat| & 
$\T[-1] \N$ &
|_mol/_s|







\end{tabularx}
\caption{Derived units of the International System of Units (SI)}
\end{table}




\begin{table}[H]
\centering
\begin{tabularx}{\linewidth}{%
  l%
  l%
  l%
  l%
  >{\setlength\hsize{1\hsize}}X%
}

Quantity & Unit & Symbol & Dim. & Definition \\\hline


plane angle & 
degree &
|_deg| & 
$1$ & 
|(Pi/180)*_rad| \\\hline


 & 
arc minute &
|_arcmin| & 
$\1$ & 
|_deg/60| \\\hline

 & 
arc second &
|_arcsec| & 
$\1$ & 
|_arcmin/60| \\\hline

 & 
gradian &
|_gon| & 
$\1$ & 
|(Pi/200)*_rad| \\\hline

 & 
turn &
|_tr| & 
$\1$ & 
|2*Pi*_rad| \\\hline

solid angle & 
spat &
|_sp| & 
$\1$ & 
|4*Pi*_sr| \\\hline




length & 
astronomical unit &
|_au| & 
$\L$ & 
|149597870700*_m| \\\hline

 &
lightyear &
|_ly| & 
$\L$ & 
|_c*_a| \\\hline

 &
parsec &
|_pc| & 
$\L$ & 
|(648000/Pi)*_au| \\\hline


 &
angstrom &
|_angstrom| & 
$\L$ & 
|1e-10*_m| \\\hline

 & 
fermi &
|_fermi| & 
$\L$ & 
|1e-15*_m| \\\hline




area & 
are &
|_ar| & 
$\L[2]$ & 
|1e2*_m^2| \\\hline


 & 
hectare &
|_hectare| & 
$\L[2]$ & 
|1e4*_m^2| \\\hline


 &
barn &
|_barn| & 
$\L[2]$ &
|1e-28*_m^2| \\\hline


volume & 
liter &
|_L| & 
$\L[3]$ & 
|0.001*_m^3| \\\hline


 & 
metric teaspoon &
|_tsp| & 
$\L[3]$ & 
|0.005*_L| \\\hline


 & 
metric tablespoon &
|_Tbsp| & 
$\L[3]$ & 
|3*_tsp| \\\hline




time & 
minute &
|_min| & 
$\T$ & 
|_60*_s| \\\hline


 & 
hour &
|_h| & 
$\T$ & 
|_60*_min| \\\hline


 & 
day &
|_d| & 
$\T$ & 
|_24*_h| \\\hline


 & 
week &
|_wk| & 
$\T$ & 
|_7*_d| \\\hline

 & 
year &
|_a| & 
$\T$ & 
|365.25*_d| \\\hline

 & 
svedberg &
|_svedberg| & 
$\T$ & 
|1e-13*_s| \\\hline


mass & 
tonne &
|_t| & 
$\M$ & 
|1000*_kg| \\\hline

\end{tabularx}
\caption{Units outside of the International System of Units (SI)}
\end{table}







\begin{table}[H]
\centering
\begin{tabularx}{\linewidth}{%
  l%
  l%
  l%
  l%
  >{\setlength\hsize{1\hsize}}X%
}

Quantity & Unit & Symbol & Dim. & Definition \\\hline


length & 
inch &
|_in| & 
$\L$ & 
|0.0254*_m| \\\hline


 & 
thou &
|_th| & 
$\L$ & 
|0.001*_in| \\\hline


 & 
pica &
|_pica| & 
$\L$ & 
|_in/6| \\\hline


 & 
point &
|_pt| & 
$\L$ & 
|_in/72| \\\hline


 & 
hand &
|_hh| & 
$\L$ & 
|4*_in| \\\hline

 & 
foot &
|_ft| & 
$\L$ & 
|12*_in| \\\hline

 & 
yard &
|_yd| & 
$\L$ & 
|3*_ft| \\\hline

 & 
rod &
|_rd| & 
$\L$ & 
|5.5*_yd| \\\hline


 & 
chain &
|_ch| & 
$\L$ & 
|4*_rd| \\\hline


 & 
furlong &
|_fur| & 
$\L$ & 
|10*_ch| \\\hline


 & 
mile &
|_mi| & 
$\L$ & 
|8*_fur| \\\hline

 & 
league &
|_lea| & 
$\L$ & 
|3*_mi| \\\hline


\end{tabularx}
\caption{Imperial units}
\end{table}





% shortcut for method definitions
\newcommand{\method}[2]{\subsubsection*{\normalfont #1.|#2|}}

% set listings language to lua
\lstset{language=Lua}




\newpage
\section{Lua Documentation}

In the following chapter, these shortcuts will be used.
\begin{lstlisting}
local D = physical.Dimension
local Q = physical.Quantity
\end{lstlisting}


\subsection{physical.Quantity}



\method{Quantity}{new(q=nil)}
\begin{quote}
  \begin{description}
  \item |q| : |object|, Optional |Quantity| or |number|

  \item |return| : The created |Quantity| object
  \end{description}

  The constuctor of the |Quantity| class. It takes an optional |quantity| or |number| for the argument |q|. If the argument |q| is given, the new quantity is a copy of it. If no argument ist given, a quantity |_1| is created.

  \begin{lstlisting}
myOne = Q()
myNumber = Q(42)
myLength = Q(73*_m)
  \end{lstlisting}
\end{quote}



\method{Quantity}{defineBase(symbol,name,dimension)}
\begin{quote}
  \begin{description}
  \item |symbol| : |string|, symbol of the base quantity

  \item |name| : |string|, name of the base quantity

  \item |dimension| : physical.|Dimension|, object which represents the base Dimension of the base quantity

  \item |return| : The created physical.|Quantity| object
  \end{description}

  A unit system has some special units, called base units, where all other units are derived from. This function is used to declare the base units. Since in this library units are the same thing as quantities, one has to define base quantities (units). 

  The function creates a global variable, an underscore concatenated with the |symbol| argument, e. g. |m| becomes the global variable |_m|.

  The |name| is used for example in the siunitx conversion function, e.g |meter| will be converted to |\meter|. 

  Each quantity has a dimension associated. The argument |dimension| allwos any dimension to be associated to base quantities. 

  
  \begin{lstlisting}
Q.defineBase("m", "meter", L)
Q.defineBase("kg", "kilogram", M)
  \end{lstlisting}
\end{quote}


\method{Quantity}{define(symbol, name, o, tobase=nil, frombase=nil)}
\begin{quote}
  Creates a new unit from an expression of other units.

  \begin{description}
  \item |symbol| : |string|, Symbol of the base quantity

  \item |name| : |string|, Name of the base quantity

  \item |o| : |physical.Quantity|, Definition of the unit.

  \item |tobase| : |function|, optional function to convert a quantity to base units.

  \item |frombase| : |function|, optional function to convert a quantity from the base units.

  \item returns a physical.|Quantity| object.
  \end{description}


\begin{lstlisting}
Q.define("L", "liter", _dm^3)
Q.define("Pa", "pascal", _N/_m^2)
Q.define("C", "coulomb", _A*_s)

Q.define(
  "degC", 
  "celsius",
  _K, 
  function(q)
    q.value = q.value + 273.15
    return q
  end,
  function(q)
    q.value = q.value - 273.15
    return q
  end
)
\end{lstlisting}
\end{quote}






\method{Quantity}{definePrefix(symbol,name,factor)}
\begin{quote}
  Defines a new prefix.

  \begin{description}
  \item |symbol| : |string|, Symbol of the base quantity

  \item |name| : |string|, Name of the base quantity

  \item |factor| : |number|, the factor which corresponds to the prefix
  \end{description}


\begin{lstlisting}
Q.definePrefix("c", "centi", 1e-2)
Q.definePrefix("a", "atto", 1e-18)
\end{lstlisting}
\end{quote}





\method{Quantity}{addPrefix(prefixes, units)}
\begin{quote}
  Create units with prefixes from a given unit.

  \begin{description}
  \item |prefixes| : |{string}|, list of unit symbols

  \item |units| : |{Quantity}|, list of quantities
  \end{description}


\begin{lstlisting}
Q.addPrefix({"n","u","m","k","M","G"},{_m,_s,_A})
\end{lstlisting}
\end{quote}








\newpage

.min(o1,o2)

.max(o1,o2)

.abs(q)

.sqrt(q)

.log(q, base)

.exp(q)

.sin(q)

.cos(q)

.tan(q)

.asin(q)

.acos(q)

.atan(q)

.sinh(q)

.cosh(q)

.tanh(q)

.asinh(q)

.acosh(q)

.atanh(q)

:to(o, usefunction)

:tosiunitx(param)

:tosiunitxsi(param)

:tosiunitxnum(param)

:isclose(o, r)

















\end{document}
