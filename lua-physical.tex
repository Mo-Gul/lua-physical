%!TEX program = lualatex
\documentclass{ltxdoc}

\usepackage{url}
\usepackage[english]{babel}
\usepackage{hyperref}
\usepackage{luacode}
\usepackage{listings}
\usepackage{siunitx}
\usepackage{tabularx}
\usepackage{float}
\usepackage{ulem}
\usepackage{xcolor}
\usepackage{framed}


\begin{luacode*}
physical = require("physical")
N = physical.Number
N.omitUncertainty = true
\end{luacode*}

\newcommand{\q}[1]{%
  \directlua{tex.print(physical.Quantity.tosiunitx(#1,"add-decimal-zero=true,scientific-notation=fixed,exponent-to-prefix=false"))}%
}


% siunitx config
\sisetup{
	output-decimal-marker = {.}, 
	per-mode = symbol,
	separate-uncertainty = false,
	add-decimal-zero = true,
	exponent-product = \cdot,
	round-mode=off
}

\lstdefinelanguage{lua}
{
  morekeywords={
    for,end,function,do,if,else,elseif,then,
    tex.print,tex.sprint,io.read,io.open,string.find,string.explode,require
  },
  morecomment=[l]{--},
  morecomment=[s]{--[[}{]]},
  morestring=[b]''
}

\lstset{
  numberstyle=\footnotesize\color{gray},
  keywordstyle=\ttfamily\bfseries\color{blue},
  basicstyle=\ttfamily\footnotesize,
  commentstyle=\itshape\color{gray},
  stringstyle=\ttfamily,
  tabsize=2,
  numbers=left,
  showstringspaces=false,
  breaklines=true,
  framexleftmargin=20pt,
  framexrightmargin=3.5pt,
  xleftmargin=24.6pt,
  breakindent=30pt,
  morekeywords={},
  frame=leftline,
  framerule=2pt,
  rulecolor=\color{blue},
  mathescape=false,
  captionpos=b,
  escapechar=`
}



% no paragraph indent
\setlength\parindent{0pt}

% set emph italic
\renewcommand{\emph}[1]{\textit{#1}}

% lualatex logo
\newcommand{\LuaLaTeX}{Lua\LaTeX}

% left bar
\renewenvironment{leftbar}[1][\hsize]
{%
    \def\FrameCommand
    {%
        {\color{red}\vrule width 2pt}%
        \hspace{10pt}%must no space.
        \fboxsep=\FrameSep%\colorbox{yellow}
    }%
    \MakeFramed{\hsize#1\advance\hsize-\width\FrameRestore}%
}
{\endMakeFramed}




\begin{document}

  \lstset{language=[LaTex]Tex}



	\title{The \textsc{lua-physical} library \\\ \\\normalsize Version 0.1}
	\author{Thomas Jenni}
	\date{\today}
	\maketitle



\begin{abstract}
\noindent |lua-physical| is a pure Lua library which provides functions and object for doing computation with physical quantities. It has been written to simplify the creation of physics problem sets. The package provides units of the SI and the imperial system. Furthermore an almost complete set of international currencies are supported, however without online exchange rates. In order to display the numbers with measurement uncertainties, the package is able to perform gaussian error propagation.
\end{abstract}

\tableofcontents






\newpage
\section{Introduction}

The author of this package is a teacher at the high school \emph{Kantonsschule Zug} in Switzerland. The main use of this package is to write physics problem sets. \LuaLaTeX does make it possible to integrate physical calculations directly into the \LuaLaTeX file. The package has been in use since 2016. Since then many bugs have been found and crushed. Nevertheless it still could be possible, that some were not found. Therefore the author recommends not to use this package industry or science. If one does so, it's the responsability of the user to check results for plausability. If the user finds some bugs, they can be reported at github.com or directly to the author (\url{thomas.jenni (at) ksz.ch}).



\section{Loading}

This package is a pure Lua library. Therefore one has to require it explicitly by calling |require("physical")|. For printing calculation results the |siunitx| package can be used. It's recommended to define a macro like |\q| to convert the lua quantity object to a |siunitx| expression.

The following Latex preambel loads the |lua-physical| package and creates a macro |\q| for printing physical quantities.
\nopagebreak
\begin{lstlisting}[language=Tex, caption=basic preamble]
  \usepackage{lua-physical}
  \usepackage{siunitx}

  % configure siunitx
  \sisetup{
    output-decimal-marker = {.}, 
    per-mode = symbol,
    separate-uncertainty = false,
    add-decimal-zero = true,
    exponent-product = \cdot,
    round-mode = off
  }

  % load lua-physical package
  \begin{luacode*}
    physical = require("physical")

    _N = physical.Number
    _N.omitUncertainty = true
  \end{luacode*}

  % print physical quantities
  \newcommand{\q}[1]{%
    \directlua{tex.print(physical.Quantity.tosiunitx(#1,"scientific-notation=fixed,exponent-to-prefix=false"))}%
  }
\end{lstlisting}


\subsection{Dependencies}

This package is standalone. If a pretty print to \LuaLaTeX{} is wanted, the package |siunitx| sould be installed. 





\section{Calculate with physical quantities}

Given the basic preamble, units can be used in lua code directly. The Result of the calculation can be printed to \TeX{} by using the macro |\q{}|.

\begin{lstlisting}
\begin{luacode}
  s = 10 * _m
	t = 2 * _s
	v = s/t
\end{luacode}

A car travels $\q{s}$ in $\q{t}$. calculate its velocity.
$$
	v=\frac{s}{t} = \frac{\q{s}}{\q{t}} = \q{v}
$$
\end{lstlisting}

\begin{luacode}
  s = 10 * _m
  t = 2 * _s

  v = s/t
\end{luacode}

\leftbar
A car travels $\q{s}$ in $\q{t}$. Calculate its velocity.
$$
  v=\frac{s}{t} = \frac{\q{s}}{\q{t}} = \q{v}
$$
\endleftbar

The physical quantities |s| for displacement, |t| for time, do have the units meter |_m| and second |_s|. Once these variables are declared, the calculation of the velocity is straight forward. In the LaTeX code the quantities are printend in the problem statement and in the solution. 


Another example is the following physics problem.

\begin{lstlisting}
\begin{luacode}
  p = 1.013 * _bar
  n = 1 * _mol
  T = 30 * _degC
  
  V = ( n * _R * T:to(_K,true) / p ):to(_L)
\end{luacode}

An ideal gas ($\q{n}$) has a pressure of $\q{p}$ and a temperature of $\q{T}$. Calculate the volume of the gas.
$$
  V=\frac{ \q{n} \cdot \q{_R} \cdot \q{T:to(_K,true)} }{ \q{p} }
  = \uuline{\q{V}}
$$
\end{lstlisting}


\begin{luacode}
  p = 1013 * _hPa
  n = 1 * _mol
  T = 0 * _degC
  
  V = ( n * _R * T:to(_K,true) / p ):to(_L)
\end{luacode}

\leftbar
An ideal gas ($\q{n}$) has a pressure of $\q{p}$ and a temperature of $\q{T}$. Calculate the volume of the gas.

$$
  V=\frac{ \q{n} \cdot \q{(_R*N(1,0.001)):to(_J/(_mol*_K))} \cdot \q{T:to(_K,true)} }{ \q{p} }
  = \uuline{\q{V}}
$$
\endleftbar










\renewcommand{\arraystretch}{1.5}


% define macros for dimensions

\newcommand{\M}[1][]{\mathrm{M}^{#1}\,}

\renewcommand{\L}[1][]{\mathrm{L}^{#1}\,}

\newcommand{\T}[1][]{\mathrm{T}^{#1}\,}

\newcommand{\I}[1][]{\mathrm{I}^{#1}\,}

\renewcommand{\theta}[1][]{\mathrm{theta}^{#1}\,}

\renewcommand{\N}[1][]{\mathrm{N}^{#1}\,}

\renewcommand{\J}[1][]{\mathrm{J}^{#1}\,}

\newcommand{\B}[1][]{\mathrm{B}^{#1}\,}

\newcommand{\C}[1][]{\mathrm{C}^{#1}\,}

\newcommand{\1}{\mathrm{1}}




\newpage
\section{Supported Units}


\subsection{Base Units}


\begin{table}[H]
\centering
\begin{tabularx}{\linewidth}{%
  >{\setlength\hsize{0.5\hsize}}X%
  l%
  l%
  c%
  >{\setlength\hsize{1.5\hsize}}X%
}

Quantity & Unit & Symbol & Dim. & Definition \\\hline

number &
-- &
$\1$ &
$\1$ & 
The dimensionless number one.  \\\hline

length &
meter & 
|_m| & 
$\L$ &
The distance light travels in vacuum during $1/ \num{299792458}$ second. \\\hline

mass &
kilogram  &  
|_kg| & 
$\M$ & 
The mass of the international protoype of the kilogram.\\\hline

time &
second & |_s| & 
$\T$ & 
Is \num{9192631770} times the period of the radiation from the transition between the two hyperfine levels of the ground state of caesium-133.  \\\hline

electric \newline current &
ampere & 
|_A| & 
$\I$ & 
The constant current which, if maintained in two straight parallel conductors of infinte length, of negligible circular crosss-section, and placed $\SI{1}{\m}$ apart in vacuum, would produce between these conductors a force equal to $\SI{2e-7}{\N\per\m}$.  \\\hline


thermodynamic \newline temperature &
kelvin  & 
|_K| & 
$\Theta$ & 
Is the fraction $1/\num{273.16}$ of the thermodynamic temperature of the triple point of water.  \\\hline

amount of \newline substance &
mole  & 
|_mol| &  
$\N$ & 
Amount of substance that contains as many particles as there are atoms in $\SI{0.012}{\kg}$ of carbon-12. \\\hline

luminous \newline intensity &
candela & 
|_cd| & 
$\J$ & 
The luminous intensity, in a given direction, of a source that emits monochromatic radiation of frequenc $\SI{540e12}{\Hz}$ and has a radiant intensity in that direction of $(1/\num{683}) \, \si{\W\per\steradian}$ \\\hline

information &
bit & 
|_bit| & 
$\B$ &
The smallest amount of information. \\\hline

currency &
euro & 
|_EUR| & 
$\L$ &
The value of the currency Euro. 

\end{tabularx}
\caption{Base units of the International System of Units (SI) expanded with the base units of information and currency.}
\end{table}







\subsection{Derived Units}

\begin{table}[H]
\centering
\begin{tabularx}{\linewidth}{%
  >{\setlength\hsize{1.2\hsize}}X%
  l%
  l%
  l%
  >{\setlength\hsize{0.8\hsize}}X%
}

Quantity & Unit & Symbol & Dimension & Definition \\\hline

plane angle & 
radian &
|_rad| & 
$1$ & 
|_1| \\\hline

solid angle & 
steradian &
|_sr| & 
$\1$ & 
|_rad^2| \\\hline

frequency &
hertz & 
|_Hz| & 
$\T[-1]$ & 
|1/_s| \\\hline

force &
newton & 
|_N| & 
$\M \L \T[-2]$ & 
|_kg*_m/_s^2| \\\hline

pressure &
pascal & 
|_Pa| & 
$\M \L[-1] \T[-2]$ & 
|_N/_m^2| \\\hline

energy &
joule & 
|_J| & 
$\M \L[2] \T[-2]$ & 
|_N*_m| \\\hline


power &
watt & 
|_W| & 
$\M \L[2] \T[-3]$ & 
|_J/_s| \\\hline

electric \newline charge &
coulomb & 
|_C| & 
$\T \I$ & 
|_A*_s| \\\hline

electric potential \newline difference &
volt & 
|_V| & 
$\M \L[2] \T[-3] \I[-1]$ & 
|_J/_C| \\\hline

capacitance &
farad & 
|_F| & 
$\L[-2] \M[-1] \T[4] \I[2]$ & 
|_C/_V| \\\hline

electric \newline resistance &
ohm & 
|_Ohm| & 
$\L[2] M \T[-3] \I[-2]$ & 
|_V/_A| \\\hline

electric \newline conductance &
siemens & 
|_S| & 
$\L[-2] \M[-1] T^{3} I^{2}$ & 
|_A/_V| \\\hline

magnetic \newline flux &
weber & 
|_Wb| & 
$\L[2] \M \T[-2] \I[-1]$ & 
|_V*_s| \\\hline

magnetic flux \newline density &
tesla & 
|_T| & 
$\M \T[-2] \I[-1]$ & 
|_V*_s| \\\hline

inductance &
henry & 
|_H| & 
$\L[2] \M \T[-2] \I[-2]$ & 
|_Wb/_A| \\\hline

Celsius \newline temperature &
degree Celsius & 
|_degC| & 
$\Theta$ & 
|_K| \\\hline

luminous flux &
lumen & 
|_lm| & 
$\J$ &
|_cd*_sr| \\\hline

illuminance &
lux & 
|_lux| & 
$\L[-2] \J$ &
|_lm/_m^2| \\\hline

activity &
becquerel & 
|_Bq| & 
$\T[-1]$ &
|1/_s| \\\hline

absorbed dose &
gray & 
|_Gy| & 
$\L[2] \T[-2]$ &
|_J/_kg| \\\hline

dose equivalent &
sievert & 
|_Sv| & 
$\L[2] \T[-2]$ &
|_J/_kg| \\\hline


catalytic \newline activity &
katal & 
|_kat| & 
$\T[-1] \N$ &
|_mol/_s|

\end{tabularx}
\caption{Derived units of the International System of Units (SI)}
\end{table}







There are a few units with dimension $\1$. The unit Bel is only available with prefix decibel, because |_B| is the unit byte.


\begin{table}[H]
\centering
\begin{tabularx}{\linewidth}{%
  l%
  l%
  l%
  l%
  >{\setlength\hsize{1\hsize}}X%
}

Quantity & Unit & Symbol & Dim. & Definition \\\hline

 &
percent \% &  
|_percent| &
$\1$ &
|1e-2*_1|  \\\hline

 &
permille \textperthousand & 
|_permille| & 
$\1$ &
|1e-3*_1|  \\\hline

 &
parts-per-million & 
|_ppm| &
$\1$ &
|1e-6*_1|  \\\hline

 &
parts-per-billion & 
|_ppb| &
$\1$ &
|1e-9*_1|  \\\hline

 &
parts-per-trillion & 
|_ppt| &
$\1$ &
|1e-12*_1|  \\\hline

 &
parts-per-quadrillion & 
|_ppq| &
$\1$ &
|1e-15*_1|  \\\hline

 &
decibel & 
|_dB| & 
$\1$ &
|_1|  \\\hline


plane angle & 
degree &
|_deg| & 
$\1$ &
|(Pi/180)*_rad| \\\hline


 & 
arc minute &
|_arcmin| & 
$\1$ &
|_deg/60| \\\hline

 & 
arc second &
|_arcsec| & 
$\1$ &
|_arcmin/60| \\\hline

 & 
gradian &
|_gon| & 
$\1$ &
|(Pi/200)*_rad| \\\hline

 & 
turn &
|_tr| & 
$\1$ & 
|2*Pi*_rad| \\\hline

solid angle & 
spat &
|_sp| & 
$\1$ & 
|4*Pi*_sr| \\\hline




length & 
astronomical unit &
|_au| & 
$\L$ & 
|149597870700*_m| \\\hline

 &
lightyear &
|_ly| & 
$\L$ & 
|_c*_a| \\\hline

 &
parsec &
|_pc| & 
$\L$ & 
|(648000/Pi)*_au| \\\hline


 &
angstrom &
|_angstrom| & 
$\L$ & 
|1e-10*_m| \\\hline

 & 
fermi &
|_fermi| & 
$\L$ & 
|1e-15*_m| \\\hline




area & 
are &
|_ar| & 
$\L[2]$ & 
|1e2*_m^2| \\\hline


 & 
hectare &
|_hectare| & 
$\L[2]$ & 
|1e4*_m^2| \\\hline


 &
barn &
|_barn| & 
$\L[2]$ &
|1e-28*_m^2| \\\hline


volume & 
liter &
|_L| & 
$\L[3]$ & 
|0.001*_m^3| \\\hline


 & 
metric teaspoon &
|_tsp| & 
$\L[3]$ & 
|0.005*_L| \\\hline


 & 
metric tablespoon &
|_Tbsp| & 
$\L[3]$ & 
|3*_tsp| \\\hline




time & 
minute &
|_min| & 
$\T$ & 
|_60*_s| \\\hline


 & 
hour &
|_h| & 
$\T$ & 
|_60*_min| \\\hline


 & 
day &
|_d| & 
$\T$ & 
|_24*_h| \\\hline


 & 
week &
|_wk| & 
$\T$ & 
|_7*_d| \\\hline

 & 
year &
|_a| & 
$\T$ & 
|365.25*_d| \\\hline

 & 
svedberg &
|_svedberg| & 
$\T$ & 
|1e-13*_s| \\\hline


mass & 
tonne &
|_t| & 
$\M$ & 
|1000*_kg| \\\hline

\end{tabularx}
\caption{Units outside of the International System of Units (SI)}
\end{table}







\begin{table}[H]
\centering
\begin{tabularx}{\linewidth}{%
  l%
  l%
  l%
  l%
  >{\setlength\hsize{1\hsize}}X%
}

Quantity & Unit & Symbol & Dim. & Definition \\\hline


length & 
inch &
|_in| & 
$\L$ & 
|0.0254*_m| \\\hline


 & 
thou &
|_th| & 
$\L$ & 
|0.001*_in| \\\hline


 & 
pica &
|_pica| & 
$\L$ & 
|_in/6| \\\hline


 & 
point &
|_pt| & 
$\L$ & 
|_in/72| \\\hline


 & 
hand &
|_hh| & 
$\L$ & 
|4*_in| \\\hline

 & 
foot &
|_ft| & 
$\L$ & 
|12*_in| \\\hline

 & 
yard &
|_yd| & 
$\L$ & 
|3*_ft| \\\hline

 & 
rod &
|_rd| & 
$\L$ & 
|5.5*_yd| \\\hline


 & 
chain &
|_ch| & 
$\L$ & 
|4*_rd| \\\hline


 & 
furlong &
|_fur| & 
$\L$ & 
|10*_ch| \\\hline


 & 
mile &
|_mi| & 
$\L$ & 
|8*_fur| \\\hline

 & 
league &
|_lea| & 
$\L$ & 
|3*_mi| \\\hline

 & 
nautical mile &
|_nmi| & 
$\L$ & 
|1852 * _m| \\\hline

 & 
nautical league &
|_nlea| & 
$\L$ & 
|3*_nmi| \\\hline

 & 
cable &
|_cbl| & 
$\L$ & 
|_nmi/10| \\\hline

 & 
fathom &
|_ftm| & 
$\L$ & 
|6*_ft| \\\hline


velocity & 
knot &
|_kn| & 
$\L[1] \T[-1]$ & 
|_nmi/_h| \\\hline


area & 
acre &
|_ac| & 
$\L[2]$ & 
|43560*_ft^2| \\\hline


volume & 
gallon &
|_gal| & 
$\L[3]$ & 
|4.54609*_L| \\\hline

 & 
quart &
|_qt| & 
$\L[3]$ & 
|_gal/4| \\\hline

 & 
pint &
|_pint| & 
$\L[3]$ & 
|_qt/2| \\\hline

 & 
cup &
|_cup| & 
$\L[3]$ & 
|_pint/2| \\\hline

 & 
gill &
|_gi| & 
$\L[3]$ & 
|_pint/4| \\\hline

 & 
fluid ounce &
|_fl_oz| & 
$\L[3]$ & 
|_gi/5| \\\hline

 & 
fluid dram &
|_fl_dr| & 
$\L[3]$ & 
|_fl_oz/8| \\\hline

\end{tabularx}
\caption{Imperial units}
\end{table}



\begin{table}[H]
\centering
\begin{tabularx}{\linewidth}{%
  l%
  l%
  l%
  l%
  >{\setlength\hsize{1\hsize}}X%
}

Quantity & Unit & Symbol & Dim. & Definition \\\hline


mass & 
grain &
|_gr| & 
$\M$ & 
|64.79891*_mg| \\\hline

 & 
pound &
|_lb| & 
$\M$ & 
|7000*_gr| \\\hline

 & 
ounce &
|_oz| & 
$\M$ & 
|_lb/16| \\\hline

 & 
dram &
|_dr| & 
$\M$ & 
|_lb/256| \\\hline

 & 
stone &
|_st| & 
$\M$ & 
|14*_lb| \\\hline

 & 
quarter &
|_qtr| & 
$\M$ & 
|2*_st| \\\hline

 & 
hundredweight &
|_cwt| & 
$\M$ & 
|4*_qtr| \\\hline

 & 
long ton &
|_ton| & 
$\M$ & 
|20*_cwt| \\\hline


\end{tabularx}
\caption{Imperial units}
\end{table}




\begin{table}[H]
\centering
\begin{tabularx}{\linewidth}{%
  l%
  l%
  l%
  l%
  >{\setlength\hsize{1\hsize}}X%
}

Quantity & Unit & Symbol & Dim. & Definition \\\hline


length & 
U.S. survey inch &
|_in_US| & 
$\L$ & 
|_m/39.37| \\\hline

 & 
U.S. survey hand &
|_hh_US| & 
$\L$ & 
|4*_in_US| \\\hline

 & 
U.S. survey foot &
|_ft_US| & 
$\L$ & 
|3*_hh_US| \\\hline

 & 
U.S. survey link &
|_li_US| & 
$\L$ & 
|0.66*_ft_US| \\\hline

 & 
U.S. survey yard &
|_yd_US| & 
$\L$ & 
|3*_ft_US| \\\hline

 & 
U.S. survey rod &
|_rd_US| & 
$\L$ & 
|5.5*_yd_US| \\\hline


 & 
U.S. survey chain &
|_ch_US| & 
$\L$ & 
|4*_rd_US| \\\hline


 & 
U.S. survey furlong &
|_fur_US| & 
$\L$ & 
|10*_ch_US| \\\hline


 & 
U.S. survey mile &
|_mi_US| & 
$\L$ & 
|8*_fur_US| \\\hline

 & 
U.S. survey league &
|_lea_US| & 
$\L$ & 
|3*_mi_US| \\\hline

 & 
U.S. survey fathom &
|_ftm_US| & 
$\L$ & 
|72*_in_US| \\\hline

 & 
U.S. survey cable &
|_cbl_US| & 
$\L$ &
|120*_ftm_US| \\\hline


\end{tabularx}
\caption{U. S. customary units}
\end{table}










\begin{table}[H]
\centering
\begin{tabularx}{\linewidth}{%
  l%
  l%
  l%
  l%
  >{\setlength\hsize{1\hsize}}X%
}

Quantity & Unit & Symbol & Dim. & Definition \\\hline


currency &
Afghan afghani&
|_AFN| & 
$\C$ & 
|0.012*_EUR| \\\hline

 &
Albanian lek &
|_ALL| & 
$\C$ & 
|0.008*_EUR| \\\hline

 &
Armenian Dram &
|_AMD| & 
$\C$ & 
|0.0018*_EUR| \\\hline

 &
Angolan Kwanza &
|_AOA| & 
$\C$ & 
|0.0028*_EUR| \\\hline

 &
Argentine Peso &
|_ARS| & 
$\C$ & 
|0.021*_EUR| \\\hline

 &
U.S. dollar &
|_USD| & 
$\C$ & 
|0.89*_EUR| \\\hline

 &
Japanese yen &
|_JPY| & 
$\C$ & 
|0.008*_EUR| \\\hline

 &
British pound &
|_GBP| & 
$\C$ & 
|1.17*_EUR| \\\hline

 &
Australian dollar &
|_AUD| & 
$\C$ & 
|0.63*_EUR| \\\hline

 &
Canadian dollar &
|_CAD| & 
$\C$ & 
|0.66*_EUR| \\\hline

 &
Swiss franc &
|_CHF| & 
$\C$ & 
|0.88*_EUR| \\\hline

 &
Chinese yuan &
|_CNY| & 
$\C$ & 
|0.13*_EUR| \\\hline

 &
Swedish krona &
|_SEK| & 
$\C$ & 
|0.094*_EUR| \\\hline

 &
New Zealand dollar &
|_NZD| & 
$\C$ & 
|0.60*_EUR| \\\hline


\end{tabularx}
\caption{Currency units based on exchange rates from 7.3.2019, 21:00 UTC.}
\end{table}


















% shortcut for method definitions
\newcommand{\method}[2]{\subsection*{|#1.#2|}}

\newcommand{\subtitle}[1]{\noindent \\\textbf{#1}}

% set listings language to lua
\lstset{language=Lua}




\newpage
\section{Lua Documentation}

In this chapter, the following shortcuts will be used.
\begin{lstlisting}
local D = physical.Dimension
local U = physical.Unit
local N = physical.Number
local Q = physical.Quantity
\end{lstlisting}

The term |number| refers to a lua integer or a lua float number. By |string| a lua string is meant and by |bool| a lua boolean.






\subsection{physical.Quantity}
The quantity class is the main part of the library. Each physical Quantity and all units are represented by an instance of this class.


\method{Q}{new(q=nil)}
\begin{quote}
  Copy Constuctor

  \subtitle{Parameters}
  \begin{description}
    \item |q| : |Q| or \ |number|, optional\\
      Optional argument is either |Q|, a |number| or |nil|.

    \item |return| : |Q|\\
      The created |Q| instance
  \end{description}

  \subtitle{Note}\\
  As an argument it takes |Q|, |number| or |nil|. If |Q| is given, a copy of it is made and returned. If a |number| is given, the function creates a dimeensionless quantity with that value. In the case |nil| is given, the quantity |_1| is returned.

  \subtitle{Example}
  \begin{lstlisting}
  myOne = Q()
  myNumber = Q(42)
  myLength = Q(73*_m)
  \end{lstlisting}
\end{quote}




\method{Q}{defineBase(symbol,name,dimension)}
\begin{quote}
  This function is used to declare the base units. Units are represented as |Q| instances.  

  \subtitle{Parameters}
  \begin{description}
  \item |symbol| : |string|\\
    symbol of the base quantity

  \item |name| : |string|\\
    name of the base quantity

  \item |dimension| : |D|\\
    Instance of the |D| class, which represents the dimension of the quantity.

  \item |return| : |Q|\\
    The created |Q| instance.
  \end{description}

  \subtitle{Note}\\
  The function creates a global variable, an underscore concatenated with the |symbol| argument, e. g. |m| becomes the global variable |_m|.

  The |name| is used for example in the siunitx conversion function, e.g |meter| will be converted to |\meter|. 

  Each quantity has a dimension associated with it. The argument |dimension| allows any dimension to be associated to base quantities. By default, the SI convention is used. 

  \subtitle{Example}
  \begin{lstlisting}
Q.defineBase("m", "meter", L)
Q.defineBase("kg", "kilogram", M)
  \end{lstlisting}
\end{quote}




\method{Quantity}{define(symbol, name, q, tobase=nil, frombase=nil)}
\begin{quote}
  Creates a new derived unit from an expression of other units. For affine quantities like the temperature in celcius, one can give convertion functions to and from base units.

  \subtitle{Parameters}
  \begin{description}
  \item |symbol| : |string|\\
  Symbol of the base quantity

  \item |name| : |string|\\
    Name of the base quantity

  \item |q| : |physical.Quantity|\\
    Definition of the unit

  \item |tobase| : |function|, optional\\
    to convert a quantity to base units

  \item |frombase| : |function|, optional\\
    to convert a quantity from the base units

  \item |return| : |Quantity|\\
    The defined quantity
  \end{description}

  \subtitle{Examples}
  \begin{lstlisting}
Q.define("L", "liter", _dm^3)
Q.define("Pa", "pascal", _N/_m^2)
Q.define("C", "coulomb", _A*_s)

Q.define(
  "degC", 
  "celsius",
  _K, 
  function(q)
    q.value = q.value + 273.15
    return q
  end,
  function(q)
    q.value = q.value - 273.15
    return q
  end
)
  \end{lstlisting}
\end{quote}






\method{Quantity}{definePrefix(symbol,name,factor)}
\begin{quote}
  Defines a new prefix.

  \begin{description}
  \item |symbol| : |string|, Symbol of the base quantity

  \item |name| : |string|, Name of the base quantity

  \item |factor| : |number|, the factor which corresponds to the prefix
  \end{description}


\begin{lstlisting}
Q.definePrefix("c", "centi", 1e-2)
Q.definePrefix("a", "atto", 1e-18)
\end{lstlisting}
\end{quote}





\method{Quantity}{addPrefix(prefixes, units)}
\begin{quote}
  Create several units with prefixes from a given unit.

  \begin{description}
  \item |prefixes| : |string|, list of unit symbols

  \item |units| : |Quantity|, list of quantities
  \end{description}


\begin{lstlisting}
Q.addPrefix({"n","u","m","k","M","G"},{_m,_s,_A})
\end{lstlisting}
\end{quote}



\method{Quantity}{to(self,q,usefunction=false)}
\begin{quote}
  Converts the quantity self to the unit of the quantity |q|. If the boolean |usefunction| is true, the convertion function is used for conversion.

  \begin{description}
  \item |self| : |Quantity| 
  \item |q| : |Quantity|
  \item |usefunction| : |Bool| 
  \end{description}

\begin{lstlisting}
s = 1.9 * _km
print( s:to(_m) )
`
\begin{luacode}
s = 1.9 * _km
tex.write(tostring(s:to(_m)) )
\end{luacode}
`

T = 10 * _degC
print( T:to(_K) )
`
\begin{luacode}
T = 10 * _degC
tex.write(tostring(T:to(_K)) )
\end{luacode}
`
print( T:to(_K,true) )
`
\begin{luacode}
T = 10 * _degC
tex.write(tostring(T:to(_K,true)) )
\end{luacode}
`
\end{lstlisting}

\end{quote}



\method{Quantity}{tosiunitx(self,param,mode)}
\begin{quote}
  Converts the quantity into a siunitx string.

  \begin{description}
  \item |self| : |Quantity| 
  \item |param| : |string|
  \item |mode| : |Number|, 0:\textbackslash SI, 1:\textbackslash num, 2:\textbackslash si
  \end{description}

\begin{lstlisting}
s = 1.9 * _km

print( s:tosiunitx() )
`
\begin{luacode}
s = 1.9 * _km
tex.write(tostring(s:tosiunitx()) )
\end{luacode}
`

print( s:tosiunitx(nil,1) )
`
\begin{luacode}
tex.write(tostring(s:tosiunitx(nil,1)) )
\end{luacode}
`

print( s:tosiunitx(nil,2) )
`
\begin{luacode}
tex.write(tostring(s:tosiunitx(nil,2)) )
\end{luacode}
`
\end{lstlisting}

\end{quote}






\method{Quantity}{isclose(self,q,r)}
\begin{quote}
  Checks if this quantity is close to another one. The argument |r| is the maximal relative deviation.

  \begin{description}
  \item |self| : |Quantity| 
  \item |q| : |Quantity,Number| 
  \item |r| : |Number| 
  \end{description}

\begin{lstlisting}
s_1 = 1.9 * _m
s_2 = 2.0 * _m
print( s_1:isclose(s_2,0.1) )
`
\begin{luacode}
s_1 = 1.9 * _m
s_2 = 2.0 * _m
tex.write(tostring(s_1:isclose(s_2,10 * _percent)) )
\end{luacode}
`
print( s_1:isclose(s_2,0.01) )
`
\begin{luacode}
s_1 = 1.9 * _m
s_2 = 2.0 * _m
tex.write(tostring(s_1:isclose(s_2,1 * _percent)) )
\end{luacode}
`
\end{lstlisting}

\end{quote}



\method{Quantity}{min(q1, q2, ...)}
\begin{quote}
  Returns the smallest quantity of several given ones. The function returns |q1| if the Quantities are equal.

  \begin{description}
  \item |q1| : |Quantity,Number|, first argument

  \item |q2| : |Quantity,Number|, second argument
  \end{description}


\begin{lstlisting}
s_1 = 15 * _m
s_2 = 5 * _m
print(s_1:min(s_2))
`
\begin{luacode}
s_1 = 15 * _m
s_2 = 5 * _m
tex.write(tostring(s_1:min(s_2)))
\end{luacode}
`
\end{lstlisting}
\end{quote}


\method{Quantity}{max(q1, q2, ...)}
\begin{quote}
  Returns the biggest quantity of several given ones. The function returns |q1| if the Quantities are equal.

  \begin{description}
  \item |q1| : |Quantity,Number|, first argument

  \item |q2| : |Quantity,Number|, second argument
  \end{description}


\begin{lstlisting}
s_1 = 15 * _m
s_2 = 5 * _m
print(s_1:max(s_2))
`
\begin{luacode}
s_1 = 15 * _m
s_2 = 5 * _m
tex.write(tostring(s_1:max(s_2)))
\end{luacode}
`
\end{lstlisting}
\end{quote}




\method{Quantity}{abs(q)}
\begin{quote}
  Returns the absolute value of the given quantity |q|.

  \begin{description}
  \item |q| : |Quantity,Number|, argument
  \end{description}


\begin{lstlisting}
U = -5 * _V
print(U)
`
\begin{luacode}
U = -5 * _V
tex.write(tostring(U))
\end{luacode}
`
print(U:abs())
`
\begin{luacode}
U = -5 * _V
tex.write(tostring(U:abs()))
\end{luacode}
`
\end{lstlisting}
\end{quote}




\method{Quantity}{sqrt(q)}
\begin{quote}
  Returns the square root of the given quantity.

  \begin{description}
  \item |q| : |Quantity,Number| argument
  \end{description}


\begin{lstlisting}
A = 25 * _m^2
s = sqrt(A)
print(s)
`
\begin{luacode}
A = 25 * _m^2
s = sqrt(A)
tex.write(tostring(s))
\end{luacode}
`
\end{lstlisting}
\end{quote}



\method{Quantity}{log(q, base)}
\begin{quote}
  Returns the logarithm of the given quantitiy. If no base is given, the natural logarithm is calculated.

  \begin{description}
  \item |q| : |Quantity,Number| dimensionless argument
  \item |base| : |Quantity,Number| dimensionless argument
  \end{description}


\begin{lstlisting}
I = 1 * _W/_m^2
I_0 = 1e-12 * _W/_m^2
print(10 * (I/I_0):log(10) * _dB )
`
\begin{luacode}
I = 1 * _W/_m^2
I_0 = 1e-12 * _W/_m^2
tex.write(tostring(10 * (I/I_0):log(10.0) *_dB ))
\end{luacode}
`
\end{lstlisting}
\end{quote}




\method{Quantity}{exp(q)}
\begin{quote}
  Returns the value of the exponential function of the given quantitiy.

  \begin{description}
  \item |q| : |Quantity,Number| dimensionless argument
  \end{description}

\begin{lstlisting}
x = 2 * _1
print( x:exp() )
`
\begin{luacode}
x = 2 * _1
tex.write(tostring(x:exp()))
\end{luacode}
`
\end{lstlisting}

\end{quote}



\method{Quantity}{sin(q)}
\begin{quote}
  Returns the value of the sinus function of the given quantitiy.

  \begin{description}
  \item |q| : |Quantity,Number| dimensionless argument
  \end{description}

\begin{lstlisting}
alpha = 30 * _deg
print( alpha:sin() )
`
\begin{luacode}
alpha = 30 * _deg
tex.write(tostring(alpha:sin()))
\end{luacode}
`
\end{lstlisting}

\end{quote}



\method{Quantity}{cos(q)}
\begin{quote}
  Returns the value of the cosinus function of the given quantity. The quantity has to be dimensionless.

  \begin{description}
  \item |q| : |Quantity,Number| dimensionless argument
  \end{description}

\begin{lstlisting}
alpha = 60 * _deg
print( alpha:cos() )
`
\begin{luacode}
alpha = 60 * _deg
tex.write(tostring(alpha:cos()))
\end{luacode}
`
\end{lstlisting}

\end{quote}



\method{Quantity}{tan(q)}
\begin{quote}
  Returns the value of the tangent function of the given quantity. The quantity has to be dimensionless.

  \begin{description}
  \item |q| : |Quantity,Number| dimensionless argument
  \end{description}

\begin{lstlisting}
alpha = 45 * _deg
print( alpha:tan() )
`
\begin{luacode}
alpha = 45 * _deg
tex.write(tostring(alpha:tan()))
\end{luacode}
`
\end{lstlisting}

\end{quote}



\method{Quantity}{asin(q)}
\begin{quote}
  Returns the value of the arcus sinus function of the given quantity. The quantity has to be dimensionless.

  \begin{description}
  \item |q| : |Quantity,Number| dimensionless argument
  \end{description}

\begin{lstlisting}
x = 0.5 * _1
print( x:asin():to(_deg) )
`
\begin{luacode}
x = 0.5 * _1
tex.write(tostring(x:asin():to(_deg)))
\end{luacode}
`
\end{lstlisting}

\end{quote}



\method{Quantity}{acos(q)}
\begin{quote}
  Returns the value of the arcus cosinus function of the given quantity. The quantity has to be dimensionless.

  \begin{description}
  \item |q| : |Quantity,Number| dimensionless argument
  \end{description}

\begin{lstlisting}
x = 0.5 * _1
print( x:acos():to(_deg) )
`
\begin{luacode}
x = 0.5 * _1
tex.write(tostring(x:acos():to(_deg)))
\end{luacode}
`
\end{lstlisting}

\end{quote}




\method{Quantity}{atan(q)}
\begin{quote}
  Returns the value of the arcus tangent function of the given quantity. The quantity has to be dimensionless.

  \begin{description}
  \item |q| : |Quantity,Number| dimensionless argument
  \end{description}

\begin{lstlisting}
x = 1 * _1
print( x:atan():to(_deg) )
`
\begin{luacode}
x = 1 * _1
tex.write(tostring(x:atan():to(_deg)))
\end{luacode}
`
\end{lstlisting}

\end{quote}




\method{Quantity}{sinh(q)}
\begin{quote}
  Returns the value of the hyperbolic sine function of the given quantity. The quantity has to be dimensionless. Since lua doesn't implement the hyperbolic functions the following formula is used 
  $$
    \sinh(x) = 0.5 \cdot e^x - 0.5 / e^x  \quad.
  $$

  \begin{description}
  \item |q| : |Quantity,Number| dimensionless argument
  \end{description}

\begin{lstlisting}
x = 1 * _1
print( x:sinh() )
`
\begin{luacode}
x = 1 * _1
tex.write(tostring(x:sinh()))
\end{luacode}
`
\end{lstlisting}

\end{quote}



\method{Quantity}{cosh(q)}
\begin{quote}
  Returns the value of the hyperbolic cosine function of the given quantity. The quantity has to be dimensionless. Since lua doesn't implement the hyperbolic functions the following formula is used 
  $$
    \cosh(x) = 0.5 \cdot e^x + 0.5 / e^x  \quad.
  $$

  \begin{description}
  \item |q| : |Quantity,Number| dimensionless argument
  \end{description}

\begin{lstlisting}
x = 1 * _1
print( x:cosh() )
`
\begin{luacode}
x = 1 * _1
tex.write(tostring(x:cosh()))
\end{luacode}
`
\end{lstlisting}

\end{quote}



\method{Quantity}{tanh(q)}
\begin{quote}
  Returns the value of the hyperbolic tangent function of the given quantity. The quantity has to be dimensionless. Since lua doesn't implement the hyperbolic functions the following formula is used 
  $$
    \tanh(x) = \frac{e^x - e^{-x}}{e^x + e^{-x}} \quad.
  $$


  \begin{description}
  \item |q| : |Quantity,Number| dimensionless argument
  \end{description}

\begin{lstlisting}
x = 1 * _1
print( x:tanh() )
`
\begin{luacode}
x = 1 * _1
tex.write(tostring(x:tanh()))
\end{luacode}
`
\end{lstlisting}

\end{quote}




\method{Quantity}{asinh(q)}
\begin{quote}
  Returns the value of the inverse hyperbolic sine function of the given quantity. The quantity has to be dimensionless. Since lua doesn't implement the hyperbolic functions the following formula is used 
  $$
    \text{asinh}(x) = \ln\left( x + \sqrt{x^2 + 1} \right)  \quad.
  $$


  \begin{description}
  \item |q| : |Quantity,Number| dimensionless argument
  \end{description}

\begin{lstlisting}
x = 1 * _1
print( x:asinh() )
`
\begin{luacode}
x = 1 * _1
tex.write(tostring(x:asinh()))
\end{luacode}
`
\end{lstlisting}

\end{quote}



\method{Quantity}{acosh(q)}
\begin{quote}
  Returns the value of the inverse hyperbolic cosine function of the given quantity. The quantity has to be dimensionless. Since lua doesn't implement the hyperbolic functions the following formula is used 
  $$
    \text{acosh}(x) = \ln\left( x + \sqrt{x^2 - 1} \right)  \quad, x > 1 \quad.
  $$


  \begin{description}
  \item |q| : |Quantity,Number| dimensionless argument bigger than or equal to one.
  \end{description}

\begin{lstlisting}
x = 2 * _1
print( x:acosh() )
`
\begin{luacode}
x = 2 * _1
tex.write(tostring(x:acosh()))
\end{luacode}
`
\end{lstlisting}

\end{quote}



\method{Quantity}{atanh(q)}
\begin{quote}
  Returns the value of the inverse hyperbolic cosine function of the given quantity. The quantity has to be dimensionless. Since lua doesn't implement the hyperbolic functions the following formula is used 
  $$
    \text{atanh}(x) = \ln\left( \frac{1 + x}{1 - x} \right)  \quad, -1 < x < 1 \quad.
  $$

  \begin{description}
  \item |q| : |Quantity,Number| dimensionless argument with magnitude smaller than one.
  \end{description}

\begin{lstlisting}
x = 0.5 * _1
print( x:atanh() )
`
\begin{luacode}
x = 0.5 * _1
tex.write(tostring(x:atanh()))
\end{luacode}
`
\end{lstlisting}

\end{quote}



%
%
%
%
\subsection{physical.Dimension}

 All physical quantities do have a physical dimension. For example the quantity \emph{Area} has the dimension $L^2$ (lenght to the power of two). In the SI-System there are seven base dimensions, from which all other dimensions are derived. Each dimension is represented by an $n$-tuple, where $n$ is the number of base dimensions. Each physical quantity has an associated dimension object. It is used two check if two quantities can be added or subtraced and if they are equal. 


\method{Dimension}{new(q=nil)}
\begin{quote}
  Constructor of the |Dimension| class.

  \subtitle{Parameters}
  \begin{description}
  \item |q| : |Dimension| or |string|, optional\\
    The name or symbol of the dimension. If |q| is a dimension, a copy of it is made. If no argument ist given, a dimension \emph{zero} is created.

  \item |return| : |Dimension|\\
    The created |Quantity| object
  \end{description}

  \subtitle{Notes}\\
  --

  \subtitle{Examples}
  \begin{lstlisting}
  V_1 = D("Velocity")
  L = D("L")
  V_2 = D(L/T)
  \end{lstlisting}
\end{quote}








%
%
%
%
\subsection{physical.Unit}

The task of this class is keeping track of the unit term. The unit term is a fraction of units. The units in the enumerator and denominator can have an exponent. 


\method{Unit}{new(u=nil)}
\begin{quote}
  Copy Constructor. It copies a given unit object. If nothing is given, an empty unit is created.

  \subtitle{Parameters}
  \begin{description}
  \item |u| : |Unit|\\
    The unit object which will be copied.

  \item |return| : |Unit|\\
    The created |Unit| object
  \end{description}

\end{quote}


\method{Unit}{new(symbol, name, prefixsymbol=nil, prefixname=nil)}
\begin{quote}
  Constructor. A new |Unit| object with symbol is created. The prefixsymbol and prefixname are optional. 

  \subtitle{Parameters}
  \begin{description}
  \item |symbol| : |String|\\
    The symbol of the unit.

  \item |name| : |String|\\
    The name of the unit.

  \item |prefixsymbol| : |String|\\
    The optional symbol of the prefix. 

  \item |prefixname| : |String|\\
    The optional name of the prefix. 

  \item |return| : |Unit|\\
    The created |Unit| object
  \end{description}

\end{quote}




\method{Unit}{tosiunitx(self)}
\begin{quote}
  The unit term will be compiled into a string, which the LaTeX package siunitx can understand.

  \subtitle{Parameters}
  \begin{description}
  \item |return| : |String|\\
    The siunitx representation of the unit term.
  \end{description}

\end{quote}







\end{document}
